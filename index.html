<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three.js</title>
  <style>
    body { margin:0; }
    canvas {width:100%; height:100%;};
  </style>
  <body>
  <script src="http://mrdoob.github.com/three.js/build/three.min.js"></script>
  <script src="jscode/OrbitControls.js"></script>
      <script>

//MrDoob fps counter
(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src="jscode/stats.min.js";document.head.appendChild(script);})()

//THREE SETUP
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 100 );
let renderer = new THREE.WebGLRenderer();
controls = new THREE.OrbitControls( camera, renderer.domElement);
controls.target = new THREE.Vector3(5,0,5);
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );

window.addEventListener( 'resize' , function (){
    renderer.setSize( window.innerWidth, window.innerHeight );
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
});

camera.position.y = 10;
camera.position.x = 10;
camera.position.z = 10;

controls.update();

//variable setup
let floormap = [];
let iO = [];

for(let i = 0; i<10;i++){
    floormap[i] = [];
    iO[i] = [];
}

for(let x = 0; x<10;x++){
    for(let y = 0; y<10;y++){
        floormap[x][y] = new interactiveObject(1, null);
    }
}

//material setup



//function setup

function level1(){
    currLevel=1;
    iO[0][0] = new interactiveObject(1, null);
    iO[0][1] = new interactiveObject(1, null);
    iO[0][2] = new interactiveObject(1, null);
    iO[0][3] = new interactiveObject(1, null);
    iO[0][4] = new interactiveObject(1, null);
    iO[0][5] = new interactiveObject(1, null);
    iO[0][6] = new interactiveObject(1, null);
    iO[0][7] = new interactiveObject(1, null);
    iO[0][8] = new interactiveObject(1, null);
    iO[0][9] = new interactiveObject(1, null);
    
    iO[1][0] = new interactiveObject(1, null);
    iO[1][1] = new interactiveObject(1, null);
    iO[1][4] = new interactiveObject(1, null);
    iO[1][5] = new interactiveObject(1, null);
    //iO[2][3] = 31;//pls remove after TODO
    //iO[5][6] = 31;//pls remove after TODO
    iO[1][8] = new interactiveObject(1, null);
    iO[1][9] = new interactiveObject(1, null);
    
    iO[2][0] = new interactiveObject(1, null);
    iO[2][2] = new interactiveObject(3, null);
    iO[2][4] = new interactiveObject(1, null);
    iO[2][5] = new interactiveObject(1, null);
    floormap[2][7] = new interactiveObject(3, null);
    iO[2][9] = new interactiveObject(1, null);
    
    iO[3][0] = new interactiveObject(1, null);
    iO[3][4] = new interactiveObject(1, null);
    iO[3][5] = new interactiveObject(1, null);
    iO[3][9] = new interactiveObject(1, null);
    
    iO[4][0] = new interactiveObject(1, null);
    iO[4][1] = new interactiveObject(1, null);
    iO[4][5] = new interactiveObject(2, null);
    iO[4][8] = new interactiveObject(1, null);
    iO[4][9] = new interactiveObject(1, null);
    
    iO[5][0] = new interactiveObject(1, null);
    iO[5][1] = new interactiveObject(1, null);
    iO[5][8] = new interactiveObject(1, null);
    iO[5][9] = new interactiveObject(1, null);
    
    iO[6][0] = new interactiveObject(1, null);
    iO[6][4] = new interactiveObject(1, null);
    iO[6][5] = new interactiveObject(1, null);
    iO[6][9] = new interactiveObject(1, null);
    
    iO[7][0] = new interactiveObject(1, null);
    iO[7][2] = new interactiveObject(4, null);
    iO[7][4] = new interactiveObject(1, null);
    iO[7][5] = new interactiveObject(1, null);
    floormap[7][7] = new interactiveObject(4, null);
    iO[7][9] = new interactiveObject(1, null);
    
    iO[8][0] = new interactiveObject(1, null);
    iO[8][1] = new interactiveObject(1, null);
    iO[8][4] = new interactiveObject(1, null);
    iO[8][5] = new interactiveObject(1, null);
    iO[8][8] = new interactiveObject(1, null);
    iO[8][9] = new interactiveObject(1, null);
        
    iO[9][0] = new interactiveObject(1, null);
    iO[9][1] = new interactiveObject(1, null);
    iO[9][2] = new interactiveObject(1, null);
    iO[9][3] = new interactiveObject(1, null);
    iO[9][4] = new interactiveObject(1, null);
    iO[9][5] = new interactiveObject(1, null);
    iO[9][6] = new interactiveObject(1, null);
    iO[9][7] = new interactiveObject(1, null);
    iO[9][8] = new interactiveObject(1, null);
    iO[9][9] = new interactiveObject(1, null);
    
    for(i=0;i<10;i++)
        for(j=0;j<10;j++)
            if(iO[i][j]==2){
                playerx=i;
                playerz=j;
            }
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

function loadGround(){
    for(let x = 0; x<10;x++){
        for(let y = 0; y<10;y++){
            if(floormap[x][y].tipo==3){ //green objective
                this.geometry = new THREE.BoxGeometry(1,1,1);
                this.material = new THREE.MeshBasicMaterial(
                    {color:0xff0000, wireframe:false});
                this.cube = new THREE.Mesh(this.geometry, this.material);
                scene.add(cube);
                floormap[x][y] = new interactiveObject(3, this.cube);
                cube.position.set( x, 0, y );
            } else if(floormap[x][y].tipo==4){ //blue objective
                this.geometry = new THREE.BoxGeometry(1,1,1);
                this.material = new THREE.MeshBasicMaterial(
                    {color:0x0000ff, wireframe:false});
                this.cube = new THREE.Mesh(this.geometry,this.material);
                scene.add(cube);
                floormap[x][y] = new interactiveObject(4, this.cube);
                cube.position.set( x, 0, y );
            } else { //ground
                this.geometry = new THREE.BoxGeometry(1,1,1);
                this.material = new THREE.MeshBasicMaterial(
                    {color:0x00ffff, wireframe:false});
                this.cube = new THREE.Mesh(this.geometry, this.material);
                scene.add(this.cube);
                floormap[x][y] = new interactiveObject(1, this.cube);
                this.cube.position.set( x, 0, y );
            }
        }
    }
}

function loadiO(){
    for(let x = 0; x<10;x++){
        for(let y = 0; y<10;y++){
            if(iO[x][y] != undefined){
                if(iO[x][y].tipo==1){ //green objective
                    this.geometry = new THREE.BoxGeometry(1,2,1);
                    this.material = new THREE.MeshBasicMaterial
                        ({color:0xffff00, wireframe:false});
                    this.cube = new THREE.Mesh(this.geometry, this.material);
                    scene.add(this.cube);
                    iO[x][y] = new interactiveObject(1, this.cube);
                    this.cube.position.set( x, 1.5, y );
                }
                else if(iO[x][y].tipo==3){ //green objective
                    this.geometry = new THREE.BoxGeometry(1,1,1);
                    this.material = new THREE.MeshBasicMaterial
                        ({color:0xff0000, wireframe:false});
                    this.cube = new THREE.Mesh(this.geometry, this.material);
                    scene.add(this.cube);
                    iO[x][y] = new interactiveObject(3, this.cube);
                    this.cube.position.set( x, 1.5, y );
                }
                else if(iO[x][y].tipo==4){ //green objective
                    this.geometry = new THREE.BoxGeometry(1,1,1);
                    this.material = new THREE.MeshBasicMaterial
                        ({color:0x0000ff, wireframe:false});
                    this.cube = new THREE.Mesh(this.geometry, this.material);
                    scene.add(this.cube);
                    iO[x][y] = new interactiveObject(4, this.cube);
                    this.cube.position.set( x, 1.5, y );
                }
            }
        }
    }
}

//object setup
function interactiveObject(tipo, reference){
    this.tipo = tipo;
    this.reference = reference;
}

//let xd = true;
//game logic
let animate = function () {
    requestAnimationFrame( animate );
    /*for(let x = 0; x<10;x++){
        for(let y = 0; y<10;y++){
            if(iO[x][y] != undefined){
                if(iO[x][y].reference != null){
                    iO[x][y].reference.rotation.x += 0.1;
                    iO[x][y].reference.rotation.y += 0.1;
                    iO[x][y].reference.rotation.z += 0.1;
                }
            }
            if(floormap[x][y] != undefined){
                if(floormap[x][y].reference != null){
                    floormap[x][y].reference.rotation.x += 0.1;
                    floormap[x][y].reference.rotation.y += 0.1;
                    floormap[x][y].reference.rotation.z += 0.1;
                }
            }
        }
    } */
    renderer.render(scene, camera);
};

level1();
loadGround();
loadiO();
animate();
</script>
</body>
</head>
</html>